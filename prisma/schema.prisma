// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  //PlanetScale does not allow foreing key
  relationMode = "prisma"
}

model User {
  id              String    @id @default(uuid()) @unique 
  nickname        String?   @unique
  email           String?   @unique
  emailVerified   DateTime?
  password        String    
  isActive        Boolean
  refresh_token   String?
  shoppingLists   ShoppingListOnUsers[]

}

model ShoppingList {
  id              String @id @default(uuid()) @unique
  name            String
  createdAt       DateTime
  users           ShoppingListOnUsers[]
  products        ProductOnShoppingLists[]
}

model ShoppingListOnUsers {
  user            User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String 
  shoppingList    ShoppingList @relation(fields: [shoppingListId], references: [id], onDelete: Cascade)
  shoppingListId  String
  owner           Boolean

  @@id([userId, shoppingListId])
  @@index([userId])
  @@index([shoppingListId])
}

model Product {
  id String @id @default(uuid()) @unique
  name String
  barcode Int?
  shoppingLists ProductOnShoppingLists[]
}

model ProductOnShoppingLists {
  shoppingList ShoppingList @relation(fields: [shoppingListId], references: [id])
  shoppingListId String
  product Product @relation(fields: [productId], references: [id])
  productId String

  @@id([shoppingListId, productId])
  @@index([shoppingListId])
  @@index([productId])


}