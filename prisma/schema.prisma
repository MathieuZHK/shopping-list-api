// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  //PlanetScale does not allow foreing key
  relationMode = "prisma"
}

model User {
  id              String    @id @default(uuid()) @unique 
  nickname        String?   @unique
  email           String?   @unique
  emailVerified   DateTime?
  password        String    
  isActive        Boolean
  refresh_token   String?
  shoppingLists   ShoppingListOnUsers[]

}

model ShoppingList {
  id              String @id @default(uuid()) @unique
  name            String
  createdAt       DateTime
  users           ShoppingListOnUsers[]
  products        ProductOnShoppingLists[]
}

model ShoppingListOnUsers {
  id              String @id @default(uuid()) @unique
  user            User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String 
  shoppingList    ShoppingList @relation(fields: [shoppingListId], references: [id], onDelete: Cascade)
  shoppingListId  String
  owner           Boolean

  @@index([userId])
  @@index([shoppingListId])
}

model Product {
  id              String @id @default(uuid()) @unique
  name            String @unique
  barcode         Int? @unique
  shoppingLists   ProductOnShoppingLists[]
}

model ProductOnShoppingLists {
  id              String @id @default(uuid()) @unique
  shoppingList    ShoppingList @relation(fields: [shoppingListId], references: [id], onDelete: Cascade)
  shoppingListId  String
  product         Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId       String 
  qty             Int?
  price           Int?

  @@index([shoppingListId])
  @@index([productId])


}